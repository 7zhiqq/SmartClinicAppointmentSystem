<!-- website/templates/archive/deleted_doctor_details.html -->

{% extends "components/base.html" %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/records.css' %}">
    
    {% if user.is_authenticated and user.role in 'manager,staff' %}
        {% include "components/sidebar/manager.html" %}

        <div class="main-content">
            <!-- Back Button -->
            <div class="mb-3">
                <a href="{% url 'archived_doctors' %}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Archived Doctors
                </a>
            </div>

            <!-- Doctor Header Card -->
            <div class="card patient-header">
                <div class="patient-header-top">
                    <div class="patient-avatar" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                        <i class="bi bi-person-x" style="font-size: 2rem;"></i>
                    </div>

                    <div class="patient-info">
                        <h2 class="patient-name">
                            Dr. {{ doctor.user_full_name }}
                            <span class="badge bg-danger ms-2">Archived</span>
                        </h2>
                        <p class="patient-meta">
                            {{ doctor.specialization|default:"General Practice" }} â€¢ 
                            {{ doctor.years_experience }} years experience
                        </p>
                    </div>
                </div>

                <div class="patient-contacts">
                    <div class="contact-item">
                        <i class="bi bi-envelope-fill"></i>
                        {{ doctor.user_email }}
                    </div>
                    <div class="contact-item">
                        <i class="bi bi-person-badge"></i>
                        License: {{ doctor.license_number }}
                    </div>
                    <div class="contact-item">
                        <i class="bi bi-calendar-check"></i>
                        {% if doctor.was_approved %}
                            <span class="badge bg-success">Was Approved</span>
                            {% if doctor.approved_at %}
                                on {{ doctor.approved_at|date:"M d, Y" }}
                            {% endif %}
                        {% else %}
                            <span class="badge bg-warning">Not Approved</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Archive Information -->
            <div class="card">
                <h4>
                    <i class="bi bi-archive"></i>
                    Archive Information
                </h4>
                <div class="card-content">
                    <table class="table table-borderless">
                        <tr>
                            <th width="30%">Archived On:</th>
                            <td>{{ doctor.archived_at|date:"F d, Y" }} at {{ doctor.archived_at|time:"h:i A" }}</td>
                        </tr>
                        <tr>
                            <th>Archived By:</th>
                            <td>
                                {% if doctor.archived_by %}
                                    {{ doctor.archived_by.get_full_name }}
                                {% else %}
                                    <span class="text-muted">System</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% if doctor.archive_reason %}
                        <tr>
                            <th>Archive Reason:</th>
                            <td>{{ doctor.archive_reason }}</td>
                        </tr>
                        {% endif %}
                        <tr>
                            <th>Original Doctor ID:</th>
                            <td><code>#{{ doctor.original_doctor_id }}</code></td>
                        </tr>
                        {% if doctor.user_id %}
                        <tr>
                            <th>User ID:</th>
                            <td><code>#{{ doctor.user_id }}</code></td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
            </div>

            <div class="card-grid">
                <!-- Professional Information -->
                <div class="card">
                    <h4>
                        <i class="bi bi-briefcase"></i>
                        Professional Information
                    </h4>
                    <div class="card-content">
                        <table class="table table-borderless">
                            <tr>
                                <th width="40%">Specialization:</th>
                                <td>
                                    {% if doctor.specialization %}
                                        <span class="badge bg-primary">{{ doctor.specialization }}</span>
                                    {% else %}
                                        <span class="text-muted">Not specified</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <th>License Number:</th>
                                <td><code>{{ doctor.license_number }}</code></td>
                            </tr>
                            <tr>
                                <th>Years of Experience:</th>
                                <td>
                                    <strong>{{ doctor.years_experience }}</strong> years
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Account Information -->
                <div class="card">
                    <h4>
                        <i class="bi bi-person-circle"></i>
                        Account Information
                    </h4>
                    <div class="card-content">
                        <table class="table table-borderless">
                            <tr>
                                <th width="40%">Username:</th>
                                <td>{{ doctor.user_username }}</td>
                            </tr>
                            <tr>
                                <th>Full Name:</th>
                                <td>{{ doctor.user_full_name }}</td>
                            </tr>
                            <tr>
                                <th>Email:</th>
                                <td>{{ doctor.user_email }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Bio Section -->
            {% if doctor.bio %}
            <div class="card">
                <h4>
                    <i class="bi bi-file-text"></i>
                    Biography
                </h4>
                <div class="card-content">
                    <p style="white-space: pre-wrap;">{{ doctor.bio }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Qualifications -->
            {% if doctor.qualifications %}
            <div class="card">
                <h4>
                    <i class="bi bi-award"></i>
                    Qualifications
                </h4>
                <div class="card-content">
                    <p style="white-space: pre-wrap;">{{ doctor.qualifications }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Additional Data -->
            {% if doctor.additional_data %}
            <div class="card">
                <h4>
                    <i class="bi bi-database"></i>
                    Additional Data
                </h4>
                <div class="card-content">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;">
                        <pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word;">{{ doctor.additional_data|safe }}</pre>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Warning Box -->
            <div class="alert alert-warning" style="margin-top: 20px;">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>Note:</strong> This is an archived record. The original doctor account may have been deleted or deactivated.
            </div>
        </div>

        <style>
            .table th {
                font-weight: 600;
                color: var(--text-muted);
            }
            
            .table td {
                color: var(--text-main);
            }
            
            .card-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 20px;
            }
            
            code {
                background: #f8f9fa;
                padding: 2px 6px;
                border-radius: 4px;
                font-family: monospace;
                font-size: 0.9em;
                color: #e83e8c;
            }
        </style>
    {% else %}
        <div class="main-content">
            <div style="text-align: center; padding: 40px;">
                <i class="bi bi-lock" style="font-size: 3rem; color: var(--text-muted);"></i>
                <h3>Access Denied</h3>
                <p>You don't have permission to view this page.</p>
                <a href="{% url 'home' %}" class="btn btn-primary">Go to Dashboard</a>
            </div>
        </div>
    {% endif %}
{% endblock %}